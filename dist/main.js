// ==UserScript==
// @name         CSGOrolltr-bot
// @namespace    http://tampermonkey.net/
// @version      0.2
// @description  Bot for csgorolltr.com
// @author       ltlaitoff
// @match        https://www.csgorolltr.com/en/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// ==/UserScript==
(()=>{"use strict";const e={color:"#4ade80"},t={color:"#facc15"},n={color:"#f87171"},r={color:"#f3f4f6"},a={color:"#7dd3fc"},o=["WW","BS"],l=[{name:null,brand:null},{name:null,brand:null},{name:null,brand:null},{name:null,brand:null},{name:null,brand:null}],s=(e,t)=>e.contains("text-success")&&"assets/icons/flash.svg"===t,c=(e,t)=>e.contains("text-warning")&&"assets/icons/warning.svg"===t;let i=!1,u=null,d=e;const m=()=>{const e=document.querySelector('[data-cy="trade-withdraw-button"]');if(!e)return;const t=!0===i?"#16a34a":"#dc2626";e.style.background=`linear-gradient(to left, ${d.color} 50%, ${t} 50%)`},g=()=>{i&&((i=>{const u=document.getElementsByTagName("cw-withdraw-search-grid")[0];if(!u)return;const d=[...u.querySelectorAll("cw-csgo-market-item-card .content")];let m=0;d.forEach((u=>{if(3===m)return;if(!((o,l)=>{if(l===r)return o;const i=o.classList,u=o.getAttribute("inlinesvg");return l===e&&!s(i,u)||l===t&&!((e,t)=>e.contains("text-warning")&&"assets/icons/flash.svg"===t)(i,u)||l===n&&!c(i,u)||l===a&&!s(i,u)&&!c(i,u)?void 0:o})(u.children[0].children[2].querySelector(".cw-icon"),i))return;var d,g;if(d=u.querySelector("label").textContent,g=u.querySelector("label").previousElementSibling.textContent,l.reduce(((e,t)=>{if(!0===e)return e;if(null===t.name&&null===t.brand)return e;let n=!1,r=!1;return 0===t.name?.length&&(t.name=null),0===t.brand?.length&&(t.brand=null),null!==t.name&&(n=d.trim().includes(t.name.trim())),null!==t.brand&&(r=g.trim().includes(t.brand.trim())),t.name,t.brand,null!==t.name&&null!==t.brand?e||n&&r:null!==t.name&&null===t.brand?e||n:null===t.name&&null!==t.brand&&(e||r)}),!1))return;const f=u.querySelector(".wear");if(f){const e=(b=f.innerText,o.reduce(((e,t)=>{if(e)return e;const n=t.trim().toLowerCase(),r=b.trim().toLowerCase(),a=r.split(" - ");if(1===a.length)return e||n===r;const o=a[0].trim().toLowerCase();return e||n===o}),!1));if(console.log("ðŸš€ ~ file: bot.js:304 ~ getCards ~ checkWearOnUntracked:",e),e)return}var b;u.click(),m++}))})(d),document.querySelectorAll(".mat-button-wrapper").forEach((e=>{"WITHDRAW"===e.innerText&&e.click()})))};setTimeout((async function e(){await(()=>{const e=document.getElementsByTagName("cw-giveaway-message-list");if(!e[0])return Promise.resolve();const t=[...e[0].querySelectorAll("button")];let n=!1;return t.forEach((e=>{"join giveaway"===e.innerText.toLowerCase()&&(n=!0,e.click())})),n?new Promise((e=>{new setTimeout((()=>e()),6e4)})):Promise.resolve()})(),setTimeout(e,5e3)}),5e3),setTimeout((async function e(){(()=>{const e=document.getElementsByTagName("cw-deposit-joined-dialog");0!==e.length&&[...e].forEach((e=>{if(!e)return;if("true"===e.dataset.csgorolltrBotTgMessage)return;if("trade found"!==e.querySelector("h1").textContent.toLowerCase())return;const t=e.querySelector(".brand")?.textContent.trim()||"",n=e.querySelector(".name").textContent.trim();"yes, i'm ready"===e.querySelector("button").textContent.trim().toLowerCase()&&((e=>{const t=new Date(Date.now()),n=`${t.getUTCHours()-t.getTimezoneOffset()/60}:${t.getUTCMinutes()}:${t.getUTCSeconds()}`;fetch(`https://api.telegram.org/bot/sendMessage?chat_id=-1&text=[${n}] ${e}`,{method:"POST"})})(`New trade! ${t}${t&&" |"} ${n}`),e.dataset.csgorolltrBotTgMessage=!0)}))})(),setTimeout(e,5e3)}),5e3),setTimeout((()=>{m()}),1500),document.addEventListener("keypress",(o=>{switch(o.code,o.code){case"Equal":if(!i){i=!0,u=setInterval(g,500);break}i=!1,clearInterval(u),u=null;break;case"KeyG":d=e;break;case"KeyY":d=t;break;case"KeyW":d=n;break;case"KeyU":m();break;case"KeyA":d=r,m();break;case"KeyB":d=a,m();break;default:return}m()}))})();