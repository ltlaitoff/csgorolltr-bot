// ==UserScript==
// @name         CSGOrolltr-bot
// @namespace    http://tampermonkey.net/
// @version      1.1.0
// @description  Bot for csgorolltr.com
// @author       ltlaitoff
// @match        https://www.csgorolltr.com/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// ==/UserScript==
(()=>{"use strict";const e={color:"#4ade80"},t={color:"#facc15"},n={color:"#f87171"},r={color:"#f3f4f6"},a={color:"#7dd3fc"},l=["WW","BS"],o=[{name:null,brand:null},{name:null,brand:null},{name:null,brand:null},{name:null,brand:null},{name:null,brand:null}],s=(e,t)=>e.contains("text-success")&&"assets/icons/flash.svg"===t,c=(e,t)=>e.contains("text-warning")&&"assets/icons/warning.svg"===t;let i=!1,u=null,d=e;const m=()=>{const e=document.querySelector(".user-balance");if(!e)return;const t=!0===i?"#16a34a":"#dc2626";e.style.background=`linear-gradient(to left, ${d.color} 50%, ${t} 50%)`},g=async()=>{i&&((i=>{const u=document.getElementsByTagName("cw-withdraw-search-grid")[0];if(!u)return;const d=[...u.querySelectorAll("cw-csgo-market-item-card .content")];let m=0;d.forEach((u=>{if(3===m)return;const d=u.querySelectorAll(".cw-icon");if(!d||0===d.length||[...d].every((l=>!((l,o)=>{if(o===r)return l;const i=l.classList,u=l.getAttribute("inlinesvg");return o===e&&!s(i,u)||o===t&&!((e,t)=>e.contains("text-warning")&&"assets/icons/flash.svg"===t)(i,u)||o===n&&!c(i,u)||o===a&&!s(i,u)&&!c(i,u)?void 0:l})(l,i))))return;var g,b;if(g=u.querySelector("label").textContent,b=u.querySelector("label").previousElementSibling.textContent,o.reduce(((e,t)=>{if(!0===e)return e;if(null===t.name&&null===t.brand)return e;let n=!1,r=!1;return 0===t.name?.length&&(t.name=null),0===t.brand?.length&&(t.brand=null),null!==t.name&&(n=g.trim().includes(t.name.trim())),null!==t.brand&&(r=b.trim().includes(t.brand.trim())),t.name,t.brand,null!==t.name&&null!==t.brand?e||n&&r:null!==t.name&&null===t.brand?e||n:null===t.name&&null!==t.brand&&(e||r)}),!1))return;const f=u.querySelector(".wear");var y;f&&(y=f.innerText,l.reduce(((e,t)=>{if(e)return e;const n=t.trim().toLowerCase(),r=y.trim().toLowerCase(),a=r.split(" - ");if(1===a.length)return e||n===r;const l=a[0].trim().toLowerCase();return e||n===l}),!1))||(u.click(),m++)}))})(d),await new Promise((e=>{setTimeout(e,400)})),(()=>{const e=document.querySelector("cw-trade-sidebar")?.querySelector("header")?.querySelectorAll("button");e.forEach((e=>{"withdraw"===e.innerText.toLowerCase()&&e.click()}))})())};setTimeout((async function e(){await(()=>{const e=document.getElementsByTagName("cw-giveaway-message-list");if(!e[0])return Promise.resolve();const t=[...e[0].querySelectorAll("button")];let n=!1;return t.forEach((e=>{"join giveaway"===e.innerText.toLowerCase()&&(n=!0,e.click())})),n?new Promise((e=>{new setTimeout((()=>e()),6e4)})):Promise.resolve()})(),setTimeout(e,5e3)}),5e3),setTimeout((async function e(){(()=>{const e=document.getElementsByTagName("cw-deposit-joined-dialog");0!==e.length&&[...e].forEach((e=>{if(!e)return;if("true"===e.dataset.csgorolltrBotTgMessage)return;if("trade found"!==e.querySelector("h1").textContent.toLowerCase())return;const t=e.querySelector("label").textContent.trim()||"",n=e.querySelector("label").previousElementSibling.textContent.trim()||"";"yes, i'm ready"===e.querySelector("button").textContent.trim().toLowerCase()&&((e=>{const t=new Date(Date.now()),n=`${t.getUTCHours()-t.getTimezoneOffset()/60}:${t.getUTCMinutes()}:${t.getUTCSeconds()}`;fetch(`https://api.telegram.org/bot/sendMessage?chat_id=-1&text=[${n}] ${e}`,{method:"POST"})})(`New trade! ${n}${n&&" |"} ${t}`),e.dataset.csgorolltrBotTgMessage=!0)}))})(),setTimeout(e,5e3)}),5e3),setTimeout((()=>{m()}),5e3),document.addEventListener("keypress",(l=>{switch(l.code,l.code){case"Equal":if(!i){i=!0,u=setInterval(g,500);break}i=!1,clearInterval(u),u=null;break;case"KeyG":d=e;break;case"KeyY":d=t;break;case"KeyW":d=n;break;case"KeyU":m();break;case"KeyA":d=r,m();break;case"KeyB":d=a,m();break;default:return}m()}))})();